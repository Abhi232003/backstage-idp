# {{ values.name | capitalize }}

{{ values.description }}

## Overview

This is an ASP.NET Web App (frontend) service deployed to **{{ values.deploymentTarget | upper }}** on Google Cloud Platform.

### Infrastructure

- **Cloud Provider**: Google Cloud Platform
- **Deployment Target**: {{ values.deploymentTarget | upper }}
{% if values.deploymentTarget == 'gke' -%}
- **GKE Cluster**: {{ values.gkeClusterName }} ({{ values.gkeRegion }})
- **Namespace**: {{ values.gkeNamespace }}
{% elif values.deploymentTarget == 'cloudrun' -%}
- **Region**: {{ values.cloudRunRegion }}
{% endif -%}
{% if values.database != 'none' -%}
- **Database**: {{ values.database | upper }} (Cloud SQL)
{% endif -%}
{% if values.enableBucket -%}
- **Storage**: Google Cloud Storage bucket (for frontend assets)
{% endif %}

## Getting Started

### Prerequisites

1. **Google Cloud SDK** installed and configured
2. **Docker** installed
3. **.NET 8.0 SDK** installed
4. **kubectl** installed (for GKE deployments)

### Setup Instructions

#### 1. Set GitHub Repository Secrets

Configure the following secrets in your GitHub repository settings:

**Required for all deployments:**
- `GOOGLE_CLOUD_CREDENTIALS` - JSON key for your GCP service account
- `GCP_PROJECT_ID` - Your Google Cloud project ID
- `GCP_REGION` - Your deployment region (e.g., {{ values.gkeRegion or values.cloudRunRegion }})

{% if values.deploymentTarget == 'gke' -%}
**Required for GKE:**
- `GKE_CLUSTER_NAME` - {{ values.gkeClusterName }}
- `GKE_ZONE` - {{ values.gkeRegion }}
- `K8S_NAMESPACE` - {{ values.gkeNamespace }}
{% endif -%}

{% if values.database != 'none' -%}
**Database secrets (set after infrastructure is provisioned):**
- `DB_PASSWORD` - Database password (generated by Terraform)
{% endif %}

#### 2. Infrastructure Provisioning

The infrastructure is automatically provisioned when you push to the main branch. The `infra.yml` workflow will:

{% if values.database != 'none' -%}
- Create a Cloud SQL {{ values.database | upper }} instance
{% endif -%}
{% if values.enableBucket -%}
- Create a Google Cloud Storage bucket for frontend assets
{% endif %}
- Output connection details for your application

#### 3. Application Deployment

1. **Add your .NET Web App code** to this repository
2. **Create a Dockerfile** in the root directory
3. **Push to main branch** - The `app-ci.yml` workflow will:
   - Build and test your .NET application
   - Create a Docker image
   - Deploy to {{ values.deploymentTarget | upper }}

### Development

#### Local Development

```bash
# Restore dependencies
dotnet restore

# Build the project
dotnet build

# Run the application
dotnet run
```

The application will be available at `https://localhost:5001` or `http://localhost:5000`.

#### Testing

```bash
# Run all tests
dotnet test
```

### CI/CD Workflows

This repository includes two GitHub Actions workflows:

1. **Infrastructure Provisioning** (`.github/workflows/infra.yml`)
   - Triggered on changes to `infra/**`
   - Uses Terraform to provision cloud resources
   - Runs automatically on the initial commit

2. **Application CI/CD** (`.github/workflows/app-ci.yml`)
   - Triggered on code changes (excluding infrastructure)
   - Builds, tests, and deploys the application
   - Only runs when .NET project files and Dockerfile are present

### Project Structure

```
├── .github/
│   └── workflows/          # GitHub Actions workflows
├── deploy/                 # Deployment configurations
│   ├── kubernetes.yaml     # Kubernetes manifests (GKE)
│   └── cloudrun.yaml      # Cloud Run service config
├── infra/                 # Infrastructure as Code (Terraform)
│   ├── main.tf            # Provider and variable definitions
│   ├── resources.tf       # Cloud resources
│   └── outputs.tf         # Output values
├── src/                   # Your .NET source code (add your code here)
├── wwwroot/               # Static web assets (CSS, JS, images)
├── Dockerfile             # Container build instructions (create this)
├── catalog-info.yaml      # Backstage catalog metadata
└── README.md             # This file
```

### Required Files for Deployment

To enable automatic deployment, ensure you have:

1. **Dockerfile** - For containerizing your application
2. **.NET project files** - `.csproj` or `.sln` files
3. **Health endpoint** - Implement a `/health` endpoint for health checks

### Example Dockerfile for ASP.NET Web App

```dockerfile
FROM mcr.microsoft.com/dotnet/aspnet:8.0 AS base
WORKDIR /app
EXPOSE 8080

FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /src
COPY . .
RUN dotnet restore
RUN dotnet publish -c Release -o /app/publish

FROM base AS final
WORKDIR /app
COPY --from=build /app/publish .
ENTRYPOINT ["dotnet", "YourWebApp.dll"]
```

### Environment Variables

The following environment variables are automatically configured:

- `ASPNETCORE_ENVIRONMENT=Production`
- `ASPNETCORE_URLS=http://+:8080`
{% if values.database != 'none' -%}
- `DB_CONNECTION_NAME` - Cloud SQL connection name
- `DB_NAME` - Database name
- `DB_USER` - Database username
- `DB_PASSWORD` - Database password
{% endif -%}
{% if values.enableBucket -%}
- `GCS_BUCKET_NAME` - Google Cloud Storage bucket name (for frontend assets)
{% endif %}

### Frontend-Specific Considerations

Since this is a frontend web application:

1. **Static Assets**: Consider using the GCS bucket for serving static assets (CSS, JS, images)
2. **CDN**: Consider setting up Google Cloud CDN for better performance
3. **API Integration**: If you need to connect to backend APIs, ensure proper CORS configuration
4. **Authentication**: Implement appropriate authentication mechanisms for user access

### Monitoring and Logging

{% if values.deploymentTarget == 'gke' -%}
- **GKE Console**: [https://console.cloud.google.com/kubernetes/workload/overview?project={{ values.gcpProjectId }}](https://console.cloud.google.com/kubernetes/workload/overview?project={{ values.gcpProjectId }})
- **Kubernetes Logs**: `kubectl logs -f deployment/{{ values.name }} -n {{ values.gkeNamespace }}`
{% elif values.deploymentTarget == 'cloudrun' -%}
- **Cloud Run Console**: [https://console.cloud.google.com/run?project={{ values.gcpProjectId }}](https://console.cloud.google.com/run?project={{ values.gcpProjectId }})
- **Cloud Run Logs**: Available in the Cloud Run console
{% endif -%}
{% if values.database != 'none' -%}
- **Cloud SQL Console**: [https://console.cloud.google.com/sql/instances?project={{ values.gcpProjectId }}](https://console.cloud.google.com/sql/instances?project={{ values.gcpProjectId }})
{% endif -%}
{% if values.enableBucket -%}
- **Cloud Storage Console**: [https://console.cloud.google.com/storage/browser?project={{ values.gcpProjectId }}](https://console.cloud.google.com/storage/browser?project={{ values.gcpProjectId }})
{% endif %}

### Troubleshooting

#### Common Issues

1. **Build fails**: Ensure your .NET project files are valid and dependencies are correctly specified
2. **Docker build fails**: Check your Dockerfile syntax and ensure all required files are included
3. **Deployment fails**: Verify your GCP credentials and cluster/service configuration
4. **Static assets not loading**: Check your wwwroot directory and ensure static files are properly configured
5. **Database connection issues**: Check your connection string and ensure the Cloud SQL proxy is configured correctly

#### Getting Help

- Check the GitHub Actions logs for detailed error information
- Review the Google Cloud Console for infrastructure status
- Ensure all required secrets are configured in your GitHub repository

---

**Owner**: {{ values.owner }}  
**Generated**: {{ "now" | date("YYYY-MM-DD") }}  
**Template**: ASP.NET Web App Template
